# V8Box Caddyfile - Reverse Proxy

# HTTP endpoint for local/rootless setup
http://{$DOMAIN:localhost}, http://*.{$DOMAIN:localhost} {
	@root path /
	redir @root /admin 302

	# Localhost mode: keep Host as-is (admin/api/pages handled by app routes)
	@localhost host localhost
	handle @localhost {
		reverse_proxy v8box:8000 {
			header_up Host {host}
			header_up X-Real-IP {remote}
			header_up X-Forwarded-For {remote}
			header_up X-Forwarded-Proto {scheme}
		}
	}

	handle {

	# Route to V8Box server
		reverse_proxy v8box:8000 {
			header_up Host {host}
			header_up X-Real-IP {remote}
			header_up X-Forwarded-For {remote}
			header_up X-Forwarded-Proto {scheme}
		}
	}

	# Enable compression
	encode gzip

	# Logging
	log {
		output file /data/access.log
	}
}
